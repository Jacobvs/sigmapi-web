# Sigma Pi, Gamma Iota Chapter Website: Installation & Setup

[_(Back to developer guide)_](https://github.com/sigmapi-gammaiota/sigmapi-web/tree/master/docs/dev-guide/index.md)

## Dependencies

* [Git](https://git-scm.com/downloads): Version control system.
  The latest version is recommended.
* [Python 3.6.*](https://www.python.org/downloads/): The primary language
  used in the development of the website.
  * [Library: venv](https://docs.python.org/3.6/library/venv.html): Used to 
    create a virtual environment to isolate the development python from the
    system-wide python.

### Additional Dependencies for Windows Developers

Developers using Windows should consider using the Windows Subsystem for Linux. You can find
the installation and setup documentation [here](https://docs.microsoft.com/en-us/windows/wsl/install-win10).
Choosing Ubuntu as your subsystem is recommended if you're new to Linux.

After installing the subsystem, you can access the Linux bash by opening a 
command prompt or PowerShell and entering:
```bash
> bash
```

Run the following to update your packages and install all development dependencies:
```bash
$ sudo apt update && sudo apt upgrade
$ sudo add-apt-repository ppa:deadsnakes/ppa
$ sudo apt update
$ sudo apt-get install python3.6 python3-pip python3.6-dev python3.6-venv
```

In some cases, the subsystem will refuse to recognize Python 3.6 as the correct version
when you run `$ python3 -V`. This can be solved with Ubuntu's update-alternatives, which allows
you to select which version of Python 3 the `$ python3` command references.
```bash
$ sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.5 1
$ sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.6 2
$ curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
$ python3 get-pip.py --force-reinstall
```
You can then toggle between each version of python with the following command. Beware: you may
have to re-install pip with the final two commands above each time you switch.
```bash
$ sudo update-alternatives --config python3
```

## First Time Setup

These steps will walk you through deploying the site on your local machine for the first time.

### 1. Clone the repository.

```bash
$ git clone https://github.com/sigmapi-gammaiota/sigmapi-web.git
...
$ cd sigmapi-web
```

### 2. Create and activate the Python virtual environment.

This creates a local python virtualenv and activates it.

```bash
$ python3 -m venv ./venv
$ source venv/bin/activate
```

### 3. Set up the development environment

You will only have to do this once. This installs requirements, loads initial
data for the database, and collects static files.

```bash
$ make dev
```

### 5. Run Django.

```bash
$ make run
```

### 6. Open a web browser on your computer, and navigate to localhost:8000 to view the site.

You can make changes to the code and your running instance will be updated automatically. You can log into the site with the admin account credentials you created earlier.  **NOTE:** Though changes will automatically update, JS and CSS resources will get cached and require a redownload using `ctrl-F5`

When you're done, you can kill the server with `ctrl-c`. Then, deactivate the python virtualenv with: 

```bash
$ deactivate
```

## Fixture Data

When you load the dev fixture data, the following users are created (along with their associated groups):

```
admin:password # The admin user.
brother:brother # A regular active brother account.
first:first # The first counselor.
second:second # The second counselor.
third:third # The third counselor.
fourth:fourth # The fourth counselor.
alumnichair:alumnichair # The alumni relations chair.
newmember:newmember # A new member.
bacchair:bacchair # The BAC chair.
housemanager:housemanager # The house manager.
parliamentarian:parliamentarian # The parliamentarian.
philanthropychair:philanthropychair # The philanthropy chair.
rushchair:rushchair # The rush chair.
sage:sage # The sage.
scholarshipchair:scholarshipchair # The scholarship chair.
socialchair:socialchair # The social chair
steward:steward # The steward.
```

### Updating Fixture Data

```bash
$ make dumpdata
```

This runs the following command:
```bash
python3 manage.py dumpdata --natural-foreign -e contenttypes -e auth.Permission > fixtures/dev_data.json
```
> --natural-foreign will use a more durable representation of foreign keys (ex. User.username instead of User.id)

> -e flags are used to exclude contenttypes and permissions, which are already generated by syncdb
